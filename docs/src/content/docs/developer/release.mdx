---
title: リリース手順
description: esa-cliのリリース手順について説明します
---
import { Steps } from '@astrojs/starlight/components';
import { Aside } from '@astrojs/starlight/components';

esa-cliのリリースは、GitHub Actionsによって大部分が自動化されています。
以下の手順で新しいバージョンをリリースできます。

## リリース手順

<Steps>
1. **バージョン番号の更新**

    `internal/version/version.go` のバージョン番号を更新します。

    ```go
    // internal/version/version.go
    const Version = "x.y.z"  // 新しいバージョン番号
    ```

2. **変更のコミットとプッシュ**

    バージョン番号の更新をコミットし、`main`ブランチにプッシュします。

    ```bash
    git add internal/version/version.go
    git commit -m "build: Bump version to x.y.z"
    git push origin main
    ```

3. **リリースタグの作成とプッシュ**

    セマンティックバージョニングに従った新しいタグを作成し、プッシュします。
    このプッシュがGitHub Actionsのリリースワークフローをトリガーします。

    ```bash
    git tag -a vX.Y.Z -m "Release vX.Y.Z"
    git push origin main --follow-tags
    ```
    <Aside type="note">
      `v`から始まるタグ (`v1.2.3`など) をプッシュすると、リリースワークフローが自動的に開始されます。
    </Aside>

</Steps>

## 自動化されていること

タグをプッシュすると、GitHub Actionsは以下の作業を自動的に行います。

-   LinuxとmacOS用のバイナリをビルド（AMD64/ARM64アーキテクチャ）
-   GitHub Releaseを新規作成
-   すべてのバイナリとチェックサムをAssetsにアップロード
-   `homebrew-esa-cli`リポジトリのHomebrew Formula (`esa-cli.rb`) を自動で更新

<Aside type="note">
  現在の設定では、macOS用のユニバーサルバイナリは作成されません。個別のアーキテクチャ用バイナリ（AMD64/ARM64）が提供されます。
</Aside>

## リリース後の確認作業

<Steps>
1. **GitHub Actionsの確認**

    [Actionsタブ](https://github.com/shellme/esa-cli/actions)で、リリースワークフローが正常に完了したことを確認します。

2. **GitHubリリースの確認**

    [リリースページ](https://github.com/shellme/esa-cli/releases)に移動し、以下を確認します。
    -   新しいバージョンのリリースが作成されていること。
    -   必要なすべてのバイナリファイル（`esa-cli_x.y.z_darwin_amd64.tar.gz`、`esa-cli_x.y.z_darwin_arm64.tar.gz`など）がアップロードされていること。

3. **Homebrew Formulaの自動更新確認**

    `homebrew-esa-cli`リポジトリで、新しいバージョン用のFormulaが自動更新されているか確認します。
    自動更新が不完全な場合は、手動での更新が必要になる場合があります。

4. **リリースノートの編集 (任意)**

    自動生成されたChangelogだけでは不十分な場合、リリースノートを編集して、変更点の概要やユーザーへのメッセージを追加します。

5. **Homebrewでのインストール確認**

    リリースが反映されたことを確認するため、ローカル環境でHomebrewを使ってインストールまたはアップグレードを試します。

    ```bash
    brew update
    brew upgrade esa-cli
    # または再インストール
    brew reinstall esa-cli
    ```
</Steps>

## トラブルシューティング

**エラー: `Resource not accessible by integration`**
-   **原因**: GitHubのパーソナルアクセストークン（PAT）が無効か、リポジトリのSecretsに正しく設定されていません。
-   **解決策**:
    1.  [PATの設定ページ](https://github.com/settings/tokens?type=beta)で、`repo`スコープを持つ有効なトークンが存在することを確認します。
    2.  `esa-cli`リポジトリの[Secretsページ](https://github.com/shellme/esa-cli/settings/secrets/actions)で、`HOMEBREW_TAP_GITHUB_TOKEN`という名前のSecretにそのトークンが正しく設定されていることを確認します。

**Homebrew Formulaの自動更新が不完全**
-   **原因**: GoReleaserの設定で、Homebrew Formulaの更新処理に問題がある場合があります。特に、`branch`や`folder`が明示的に指定されていない場合、GoReleaserが正しいブランチやパスを判断できない可能性があります。
-   **解決策**:
    1.  `goreleaser.yml`の`brews`セクションに`branch: main`と`folder: Formula`が明示的に指定されているか確認します。
    2.  `homebrew-esa-cli`リポジトリで、自動更新されたFormulaの内容を確認します。
    3.  必要に応じて、手動でバージョン番号とSHA256を更新します。
    4.  設定ファイルの競合が発生した場合は、既存の設定ファイルを削除してから再インストールします。